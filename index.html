<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Secure Redirect</title>

  <script>
    // ✔ Add trusted teacher emails here
    const allowedEmails = [
      "teacher1@gmail.com",
      "teacher2@gmail.com",
      "teacher3@hotmail.com"
    ];

    // ✔ Add your fallback password here
    const fallbackPassword = "123456";

    async function start() {
      // Get form link from URL parameter ?form=...
      const urlParams = new URLSearchParams(window.location.search);
      const formURL = urlParams.get("form");

      if (!formURL) {
        document.body.innerHTML = "<h2>No form link provided!</h2>";
        return;
      }

      // Try to get Google account email automatically
      try {
        const token = await google.accounts.id.initialize({
          client_id: "427630977928-151dd7ia0joijtta69bntnbkkp7bp0s9.apps.googleusercontent.com",
          callback: handleCredentialResponse,
        });
      } catch (e) {
        showPasswordPrompt(formURL);
      }
    }

    function handleCredentialResponse(response) {
      try {
        const data = jwt_decode(response.credential);
        const userEmail = data.email;

        if (allowedEmails.includes(userEmail)) {
          window.location.href = formURL;
        } else {
          showPasswordPrompt(formURL);
        }
      } catch (e) {
        showPasswordPrompt(formURL);
      }
    }

    function showPasswordPrompt(formURL) {
      const pwd = prompt("Enter access password:");

      if (pwd === fallbackPassword) {
        window.location.href = formURL;
      } else {
        alert("Access Denied");
      }
    }
  </script>

  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>

</head>

<body onload="start()">
  <h2 style="text-align:center;">Authenticating…</h2>
</body>
</html>

